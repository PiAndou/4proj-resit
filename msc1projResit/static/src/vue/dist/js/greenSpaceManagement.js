(function(e){function t(t){for(var a,i,o=t[0],c=t[1],p=t[2],u=0,d=[];u<o.length;u++)i=o[u],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&d.push(r[i][0]),r[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);l&&l(t);while(d.length)d.shift()();return s.push.apply(s,p||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(a=!1)}a&&(s.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},r={greenSpaceManagement:0},s=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/static/src/vue/dist/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var p=0;p<o.length;p++)t(o[p]);var l=c;s.push([1,"chunk-vendors"]),n()})({1:function(e,t,n){e.exports=n("4bda")},"405b":function(e,t,n){},"4bda":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("a026"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"container-fluid"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-6"},[n("div",{staticClass:"card card-success card-outline"},[e._m(0),n("div",{staticClass:"card-body table-responsive p-0"},[n("table",{staticClass:"table table-head-fixed text-nowrap"},[e._m(1),n("tbody",e._l(e.greenSpaces,(function(t,a){return n("tr",{key:t.id,attrs:{item:t,index:a}},[n("td",[e._v(e._s(a+1))]),n("td",[e._v(e._s(t.name))]),n("td",[e._v(e._s(t.establishmentType.libel))]),n("td",[n("i",{staticClass:"fas fa-edit",staticStyle:{cursor:"pointer"},on:{click:function(n){return e.editGreenSpace(t)}}}),e._v(" Â¦ "),n("i",{staticClass:"fas fa-trash",staticStyle:{cursor:"pointer"},on:{click:function(n){return e.deleteGreenSpace(t)}}})])])})),0)])])])]),n("div",{staticClass:"col-6"},[n("GreenSpaceForm",{attrs:{editinggreenSpace:e.editinggreenSpace,establishmentTypes:e.establishmentTypes},on:{greenSpaceCreated:e.addGreenSpace}})],1)]),e._m(2)])])},s=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card-header"},[n("h3",{staticClass:"card-title"},[e._v("Green Areas")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("thead",[n("tr",[n("th",[e._v("#")]),n("th",[e._v("Name")]),n("th",[e._v("Establishment Type")]),n("th",[e._v("Actions")])])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"row"},[n("div",{attrs:{id:"map"}})])}],i=(n("159b"),n("7db0"),n("c740"),n("a434"),n("4de4"),n("d81d"),n("3d20")),o=n.n(i),c=n("1da1"),p=n("d4ec"),l=n("bee2"),u=(n("b0c0"),n("96cf"),n("bc3a")),d=n.n(u),m=n("ae38"),g=new m["a"],f=function(){function e(){Object(p["a"])(this,e)}return Object(l["a"])(e,[{key:"getGreenSpaces",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d()({method:"POST",url:g.getbaseURL(),data:{query:"{ \n                    greenSpaces{\n                        id\n                        name\n                        positionLtd\n                        positionLgt\n                        establishmentType{\n                            id\n                            libel\n                        }\n                    }\n                }"}});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getEstablishmentTypes",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d()({method:"POST",url:g.getbaseURL(),data:{query:"{ \n                    establishmentTypes{\n                        id\n                        libel\n                    }\n                }"}});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"writeGreenSpace",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!=t.id){e.next=7;break}return e.next=3,d.a.post(g.getbaseURL(),{query:"\n                    mutation ($name: String!, $establishmentTypeId: Int!, $positionLtd: Decimal!, $positionLgt: Decimal!) {\n                        createGreenspace (\n                            name: $name,\n                            establishmentTypeId: $establishmentTypeId,\n                            positionLtd: $positionLtd,\n                            positionLgt: $positionLgt\n                        ){\n                            greenSpace {\n                                id\n                                name\n                                positionLtd\n                                positionLgt\n                                establishmentType{\n                                    id\n                                    libel\n                                }\n                            }\n                            message\n                            result\n                        }\n                    }",variables:{name:t.name,establishmentTypeId:t.establishmentType,positionLtd:t.positionLtd,positionLgt:t.positionLgt}},{headers:g.getheaders()});case 3:return n=e.sent,e.abrupt("return",n);case 7:return e.next=9,d.a.post(g.getbaseURL(),{query:"\n                    mutation ($greenSpaceId: Int!, $name: String!, $establishmentTypeId: Int!, $positionLtd: Decimal!, $positionLgt: Decimal!) {\n                        updateGreenspace (\n                            greenSpaceId: $greenSpaceId,\n                            name: $name,\n                            establishmentTypeId: $establishmentTypeId,\n                            positionLtd: $positionLtd,\n                            positionLgt: $positionLgt\n                        ){\n                            greenSpace {\n                                id\n                                name\n                                positionLtd\n                                positionLgt\n                                establishmentType{\n                                    id\n                                    libel\n                                }\n                            }\n                            message\n                            result\n                        }\n                    }",variables:{greenSpaceId:t.id,name:t.name,establishmentTypeId:t.establishmentType,positionLtd:t.positionLtd,positionLgt:t.positionLgt}},{headers:g.getheaders()});case 9:return a=e.sent,e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"deleteGreenSpace",value:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={query:"\n                mutation($greenSpaceId:Int!){\n                    deleteGreenspace(\n                        greenSpaceId: $greenSpaceId\n                    ){\n                        message\n                        result\n                    }\n                }",variables:{greenSpaceId:t.id}},e.next=3,d.a.post(g.getbaseURL(),n,{headers:g.getheaders()});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),h=n("642f"),b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("form",{attrs:{role:"form"},on:{submit:function(t){return t.preventDefault(),e.onSubmit.apply(null,arguments)}}},[n("div",{staticClass:"card card-success card-outline"},[n("div",{staticClass:"card-body"},[n("div",{staticClass:"form-group"},[n("label",{attrs:{for:"greenSpace_name"}},[e._v("Name")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.greenSpace_name,expression:"greenSpace_name"}],staticClass:"form-control",attrs:{type:"text",id:"greenSpace_name",placeholder:"Enter greenSpace's Name",autocomplete:"off"},domProps:{value:e.greenSpace_name},on:{input:function(t){t.target.composing||(e.greenSpace_name=t.target.value)}}}),n("span",{staticClass:"error invalid-feedback",attrs:{"data-error":""}})]),n("div",{staticClass:"form-group"},[n("label",[e._v("Establishment Type")]),n("select",{directives:[{name:"model",rawName:"v-model",value:e.greenSpace_establishmentType,expression:"greenSpace_establishmentType"}],staticClass:"form-control",on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.greenSpace_establishmentType=t.target.multiple?n:n[0]}}},e._l(e.establishmentTypes,(function(t,a){return n("option",{key:t.id,attrs:{index:a},domProps:{value:t.id}},[e._v(" "+e._s(t.libel)+" ")])})),0)]),e._m(0)]),n("div",{staticClass:"card-footer"},[n("button",{staticClass:"btn btn-default",attrs:{type:"button"},on:{click:function(t){return e.clearFields()}}},[e._v(" Cancel ")]),n("button",{staticClass:"btn btn-success float-right",attrs:{type:"submit"}},[e._v(" Save ")])])]),e._m(1)])])},v=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"btn btn-block btn-success",attrs:{type:"button","data-toggle":"modal","data-target":"#addMapMaker"}},[n("i",{staticClass:"fas fa-map-marker-alt"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"modal fade",attrs:{id:"addMapMaker"}},[n("div",{staticClass:"modal-dialog"},[n("div",{staticClass:"modal-content"},[n("div",{staticClass:"modal-body"},[n("div",{attrs:{id:"map-form"}})]),n("div",{staticClass:"modal-footer justify-content-between"},[n("button",{staticClass:"btn btn-default",attrs:{type:"button","data-dismiss":"modal"}},[e._v(" Cancel ")]),n("button",{staticClass:"btn btn-success",attrs:{type:"button","data-dismiss":"modal"}},[e._v(" Save ")])])])])])}],S=(n("bf19"),n("4272")),_=new S["a"]({apiKey:"AIzaSyBS41ImYc89k62_prfIYCLpBlPjbNGAMk4",version:"weekly"}),y=function(){function e(){Object(p["a"])(this,e)}return Object(l["a"])(e,[{key:"getLoader",value:function(){return _}}]),e}(),L=new f,w=new h["a"],k=new y,C={name:"GreenSpaceForm",props:{editinggreenSpace:Object,establishmentTypes:Array},data:function(){return{greenSpace_id:null,greenSpace_name:"",greenSpace_establishmentType:0,greenSpace_positionLtd:0,greenSpace_positionLgt:0,map_form:null,map_marker:null,messageError:[]}},mounted:function(){var e=this;k.getLoader().load().then((function(){e.setMapCenter(),e.setMarker(new google.maps.LatLng(0,0))}))},methods:{onSubmit:function(){var e=this,t={id:this.greenSpace_id,name:this.greenSpace_name,positionLtd:this.greenSpace_positionLtd,positionLgt:this.greenSpace_positionLgt,establishmentType:this.greenSpace_establishmentType};L.writeGreenSpace(t).then((function(n){null==t.id?1==n.data.data.createGreenspace.result?(e.clearFields(),w.showToast(n.data.data.createGreenspace.message,"success"),e.$emit("greenSpaceCreated",n.data.data.createGreenspace.greenSpace)):w.showToast(n.data.data.createGreenspace.message,"error"):1==n.data.data.updateGreenspace.result?(e.clearFields(),w.showToast(n.data.data.updateGreenspace.message,"success"),e.$emit("greenSpaceCreated",n.data.data.updateGreenspace.greenSpace)):w.showToast(n.data.data.updateGreenspace.message,"error")})).catch((function(e){console.log(e)}))},clearFields:function(){this.greenSpace_id=null,this.greenSpace_name="",this.greenSpace_establishmentType=0,this.greenSpace_positionLtd=0,this.greenSpace_positionLgt=0,this.map_marker.setMap(null),this.setMapCenter(),this.messageError=[]},setGreenSpacePosition:function(e){this.map_marker.setMap(null),this.greenSpace_positionLtd=e.coords.toJSON().lat,this.greenSpace_positionLgt=e.coords.toJSON().lng,this.setMarker(e.coords)},setMapCenter:function(){var e=this;this.map_form=new google.maps.Map(document.getElementById("map-form"),{center:{lat:this.greenSpace_positionLtd,lng:this.greenSpace_positionLgt},zoom:2}),this.map_form.addListener("click",(function(t){e.setGreenSpacePosition({coords:t.latLng})}))},setMarker:function(e){this.map_marker=new google.maps.Marker({position:e,map:this.map_form,icon:"https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png"})}},watch:{editinggreenSpace:function(e){this.greenSpace_id=e.id,this.greenSpace_name=e.name,this.greenSpace_positionLtd=e.positionLtd,this.greenSpace_positionLgt=e.positionLgt,this.greenSpace_establishmentType=e.establishmentType.id,this.map_marker.setMap(null),this.setMapCenter(),this.setMarker(new google.maps.LatLng(e.positionLtd,e.positionLgt))}}},T=C,M=(n("c036"),n("2877")),G=Object(M["a"])(T,b,v,!1,null,"18345c12",null),x=G.exports,O=new f,j=new h["a"],$=new y,I={name:"GreenSpace",components:{GreenSpaceForm:x},props:{},data:function(){return{greenSpaces:[],establishmentTypes:[],editinggreenSpace:null,idcheckbox:null,map_markers:{},map:null}},mounted:function(){var e=this;O.getGreenSpaces().then((function(t){e.greenSpaces=t.data.data.greenSpaces,$.getLoader().load().then((function(){t.data.data.greenSpaces.length>0?(e.setMapCenter(e.greenSpaces[0].positionLtd,e.greenSpaces[0].positionLgt),e.greenSpaces.forEach(e.initMarkers)):e.setMapCenter(0,0)}))})).catch((function(e){return console.error(e)})),O.getEstablishmentTypes().then((function(t){e.establishmentTypes=t.data.data.establishmentTypes})).catch((function(e){return console.error(e)}))},methods:{addGreenSpace:function(e){if(this.greenSpaces.find((function(t){return t.id===e.id}))){var t=this.greenSpaces.findIndex((function(t){return t.id===e.id}));this.greenSpaces.splice(t,1,e),this.map_markers[e.id].setMap(null),this.setMarker(new google.maps.LatLng(e.positionLtd,e.positionLgt),e.id)}else this.greenSpaces.unshift(e),this.setMarker(new google.maps.LatLng(e.positionLtd,e.positionLgt),e.id)},editGreenSpace:function(e){this.editinggreenSpace=e},deleteGreenSpace:function(e){var t=this;o.a.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then((function(n){n.isConfirmed&&O.deleteGreenSpace(e).then((function(n){1==n.data.data.deleteGreenspace.result?(t.greenSpaces=t.greenSpaces.filter((function(t){return t.id!==e.id})),t.map_markers[e.id].setMap(null),delete t.map_markers[e.id],j.showToast(n.data.data.deleteGreenspace.message,"success")):j.showToast(n.data.data.deleteGreenspace.message,"error")})).catch((function(e){return console.error(e)}))}))},setMapCenter:function(e,t){this.map=new google.maps.Map(document.getElementById("map"),{center:{lat:e,lng:t},zoom:1})},initMarkers:function(e){this.setMarker(new google.maps.LatLng(e.positionLtd,e.positionLgt),e.id)},setMarker:function(e,t){var n=new google.maps.Marker({position:e,map:this.map,icon:"https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png"});n.metadata={id:t},this.map_markers[t]=n}}},E=I,P=(n("503d"),Object(M["a"])(E,r,s,!1,null,"1d306b64",null)),R=P.exports;a["a"].config.productionTip=!1,new a["a"]({el:"#greenSpaces",components:{greenspace:R}})},"503d":function(e,t,n){"use strict";n("bfcc")},"642f":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n("d4ec"),r=n("bee2"),s=n("3d20"),i=n.n(s),o=function(){function e(){Object(a["a"])(this,e)}return Object(r["a"])(e,[{key:"showToast",value:function(e,t){i.a.fire({position:"top-end",icon:t,toast:!0,title:e,showConfirmButton:!1,timer:2500})}}]),e}()},ae38:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n("d4ec"),r=n("bee2"),s=function(){function e(){Object(a["a"])(this,e)}return Object(r["a"])(e,[{key:"getbaseURL",value:function(){return"/graphql"}},{key:"getheaders",value:function(){return{"Content-Type":"application/json"}}}]),e}()},bfcc:function(e,t,n){},c036:function(e,t,n){"use strict";n("405b")}});
//# sourceMappingURL=greenSpaceManagement.js.map